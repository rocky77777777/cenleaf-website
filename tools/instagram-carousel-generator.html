<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstagramÁîªÂÉè‰ΩúÊàê„ÉÑ„Éº„É´ | È†àÂ¥é„Çπ„Çø„Ç§„É´</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>üì±</text></svg>" type="image/svg+xml">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }


        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 700px;
        }

        .input-section {
            width: 400px;
            padding: 30px;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: 80vh;
        }

        .preview-section {
            flex: 1;
            padding: 30px;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .edit-section {
            width: 350px;
            padding: 30px;
            background: #fafafa;
            border-left: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: 80vh;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-weight: bold;
            font-size: 12px;
        }

        .step-title {
            font-size: 14px;
            font-weight: bold;
        }

        select {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            background: white;
            margin-bottom: 15px;
        }

        textarea {
            width: 100%;
            height: 350px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            resize: vertical;
            font-family: 'Noto Sans JP', monospace;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        button {
            padding: 10px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button.secondary {
            background: #e0e0e0;
            color: #333;
        }

        button.secondary:hover {
            background: #d0d0d0;
        }

        .slide-counter {
            margin-top: 8px;
            text-align: center;
            color: #666;
            font-size: 12px;
        }

        .preview-frame {
            width: 270px;
            height: 338px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 15px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .preview-content {
            padding: 20px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            font-size: 12px;
            line-height: 1.6;
        }

        .navigation-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .nav-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .nav-button:hover {
            background: #667eea;
            color: white;
        }

        .nav-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .slide-indicator {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            min-width: 60px;
            text-align: center;
        }

        .generate-button {
            width: 100%;
            padding: 14px;
            margin-top: 20px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            font-size: 15px;
        }

        .edit-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .edit-panel h3 {
            font-size: 14px;
            margin-bottom: 12px;
            color: #333;
        }

        .edit-control {
            margin-bottom: 15px;
        }

        .edit-control label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .edit-control input,
        .edit-control textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px;
        }

        .edit-control textarea {
            height: 100px;
            resize: vertical;
        }

        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .color-option.gradient {
            background: linear-gradient(135deg, var(--color1) 0%, var(--color2) 100%);
        }

        .color-label {
            font-size: 11px;
            color: #666;
            margin-right: 5px;
        }

        .layout-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layout-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .layout-group label {
            font-size: 12px;
            color: #666;
        }

        .layout-options {
            display: flex;
            gap: 5px;
        }

        .layout-option {
            width: 32px;
            height: 32px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .layout-option:hover {
            border-color: #667eea;
        }

        .layout-option.selected {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .font-size-control {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .size-slider {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .size-slider label {
            font-size: 11px;
            color: #666;
            min-width: 60px;
        }

        .size-slider input[type="range"] {
            flex: 1;
        }

        .size-value {
            font-size: 11px;
            color: #667eea;
            min-width: 40px;
            text-align: right;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .action-button {
            flex: 1;
            padding: 8px;
            font-size: 12px;
        }

        .success-badge {
            background: #48bb78;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-left: 8px;
        }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .loading.active {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .download-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .download-modal.active {
            display: flex;
        }

        .download-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .download-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .download-header h2 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .download-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .download-item {
            aspect-ratio: 1;
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
            font-weight: bold;
        }

        .download-item:hover {
            background: #667eea;
            color: white;
        }

        .download-actions {
            display: flex;
            gap: 10px;
        }

        .download-actions button {
            flex: 1;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .input-section,
            .edit-section {
                width: 100%;
                max-width: 100%;
                border: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì± InstagramÁîªÂÉè‰ΩúÊàê„ÉÑ„Éº„É´</h1>
            <p>ÊñáÁ´†„ÇíÂÖ•Âäõ„Åô„Çã„Å†„Åë„Åß„ÄÅ„Éó„É≠‰ªïÊßò„ÅÆInstagramÊäïÁ®øÁîªÂÉè„ÇíËá™Âãï‰ΩúÊàê<br>„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„ÅßÊñáÁ´†„ÇíÂÖ•„Çå„Çã„Å†„Åë„Åß„Ç´„É´„Éº„Çª„É´ÊäïÁ®ø„Åå„Çµ„ÇØ„ÉÉ„Å®„Åß„Åç„Çã</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">„Ç¢„Çπ„Éö„ÇØ„ÉàÊØî„ÇíÈÅ∏Êäû</div>
                </div>
                <select id="aspectRatio" onchange="updateAspectRatio()">
                    <option value="4:5">4:5 (Á∏¶Âûã„ÉªÊé®Â•®)</option>
                    <option value="9:16">9:16 („Çπ„Éà„Éº„É™„Éº„Ç∫)</option>
                    <option value="1:1">1:1 (Ê≠£ÊñπÂΩ¢)</option>
                    <option value="16:9">16:9 (Ê®™Âûã)</option>
                </select>

                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„ÅßÂÜÖÂÆπ„ÇíÂÖ•Âäõ</div>
                </div>
                <textarea id="markdownInput" placeholder="# „Çø„Ç§„Éà„É´

## „Çπ„É©„Ç§„Éâ1„ÅÆ„Çø„Ç§„Éà„É´
Êú¨Êñá„ÉÜ„Ç≠„Çπ„Éà

## „Çπ„É©„Ç§„Éâ2„ÅÆ„Çø„Ç§„Éà„É´
Êú¨Êñá„ÉÜ„Ç≠„Çπ„Éà" oninput="previewSlideCount()"></textarea>
                
                <div class="slide-counter">
                    ‰∫àÊÉ≥„Çπ„É©„Ç§„ÉâÊï∞: <span id="slideCount">0</span>Êûö
                </div>

                <div class="button-group">
                    <button onclick="loadSample()">„Çµ„É≥„Éó„É´Ë™≠Ëæº</button>
                    <button onclick="clearInput()" class="secondary">„ÇØ„É™„Ç¢</button>
                </div>

                <button onclick="parseMarkdown()" class="generate-button">
                    „Éë„Éº„Çπ„Åó„Å¶„Çπ„É©„Ç§„Éâ„ÇíÁîüÊàê
                </button>
            </div>

            <div class="preview-section">
                <h3 style="font-size: 14px; margin-bottom: 10px;">„Éó„É¨„Éì„É•„Éº</h3>
                
                <div class="preview-frame" id="previewFrame">
                    <div class="preview-content" id="previewContent">
                        „Éó„É¨„Éì„É•„Éº„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô
                    </div>
                </div>

                <div class="navigation-controls" id="navigationControls" style="display: none;">
                    <button class="nav-button" onclick="previousSlide()" id="prevButton">‚Üê</button>
                    <div class="slide-indicator">
                        <span id="currentSlide">1</span> / <span id="totalSlides">1</span>
                    </div>
                    <button class="nav-button" onclick="nextSlide()" id="nextButton">‚Üí</button>
                </div>

                <button onclick="generateImages()" class="generate-button" id="generateImagesButton" style="display: none;">
                    üì∏ ÁîªÂÉè„ÇíÁîüÊàê„Åô„Çã
                </button>
            </div>

            <div class="edit-section" id="editSection" style="display: none;">
                <div class="edit-panel" id="editPanels">
                    <h3>„Çπ„É©„Ç§„ÉâÁ∑®ÈõÜ <span id="currentSlideBadge" class="success-badge">1</span></h3>
                    
                    <div class="edit-control">
                        <label>„Çø„Ç§„Éà„É´</label>
                        <input type="text" id="editTitle" onchange="updateSlideContent('title')">
                    </div>

                    <div class="edit-control">
                        <label>Êú¨Êñá</label>
                        <textarea id="editBody" onchange="updateSlideContent('body')"></textarea>
                    </div>

                    <div class="edit-control">
                        <label>ËÉåÊôØËâ≤</label>
                        <div class="color-palette" id="colorPalette"></div>
                    </div>

                    <div class="edit-control">
                        <label>„É¨„Ç§„Ç¢„Ç¶„Éà</label>
                        <div class="layout-controls" id="layoutControls"></div>
                    </div>

                    <div class="edit-control">
                        <label>ÊñáÂ≠ó„Çµ„Ç§„Ç∫</label>
                        <div class="font-size-control">
                            <div class="size-slider">
                                <label>„Çø„Ç§„Éà„É´</label>
                                <input type="range" id="titleSize" min="40" max="120" value="68" 
                                       onchange="updateFontSize('titleSize', this.value)">
                                <span class="size-value" id="titleSizeValue">68px</span>
                            </div>
                            <div class="size-slider">
                                <label>Êú¨Êñá</label>
                                <input type="range" id="bodySize" min="20" max="80" value="44" 
                                       onchange="updateFontSize('bodySize', this.value)">
                                <span class="size-value" id="bodySizeValue">44px</span>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button onclick="addSlide()" class="action-button">„Çπ„É©„Ç§„ÉâËøΩÂä†</button>
                        <button onclick="deleteCurrentSlide()" class="action-button secondary">ÂâäÈô§</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>ÁîªÂÉè„ÇíÁîüÊàê‰∏≠...</p>
        </div>
    </div>

    <div class="download-modal" id="downloadModal">
        <div class="download-content">
            <div class="download-header">
                <h2>üéâ ÁîªÂÉèÁîüÊàêÂÆå‰∫ÜÔºÅ</h2>
                <p>„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂÄãÂà•„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</p>
            </div>
            <div class="download-grid" id="downloadGrid"></div>
            <div class="download-actions">
                <button onclick="downloadAll()">„Åô„Åπ„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                <button onclick="closeModal()" class="secondary">Èñâ„Åò„Çã</button>
            </div>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let slidesData = [];
        let currentSlide = 1;
        let totalSlides = 0;
        let aspectRatio = '4:5';

        // „Çµ„É≥„Éó„É´„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥
        const sampleMarkdown = `## „ÄåAI„ÅÆÊ©üËÉΩ„ÇíË¶ö„Åà„Çã„Äç„Å™„Çì„Å¶ÊôÇÈñì„ÅÆ„É†„ÉÄ„Å†„Å£„ÅüË©±

Ê≠£Áõ¥Ë®Ä„ÅÑ„Åæ„Åô„ÄÇ
**AIÂãâÂº∑‰ºö„Å®„ÅãË°å„Åã„Å™„Åè„Å¶„ÅÑ„ÅÑ**„Åß„Åô„ÄÇ

ÂÉï„ÇÇ3Âπ¥Ââç„ÅØÂêå„Åò„Åß„Åó„Åü„ÄÇ
- ÂàÜÂéö„ÅÑ„Éû„Éã„É•„Ç¢„É´Ë™≠„Çì„Åß
- YouTubeÂãïÁîªË¶ã„Åæ„Åè„Å£„Å¶  
- ÊúâÊñô„Çª„Éü„Éä„ÉºÂèó„Åë„Å¶

„Åß„ÇÇ3„É∂ÊúàÂæå...
**ChatGPT„ÅåÂ§ßÂûã„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„Åó„Å¶Ë¶ö„Åà„ÅüÊ©üËÉΩ„ÅÆÂçäÂàÜ„ÅåÊ∂à„Åà„Å¶„Åü**

„ÅÇ„ÅÆÂãâÂº∑ÊôÇÈñì„ÄÅ„Å™„Çì„Å†„Å£„Åü„ÅÆÔºü

## Ê∞ó„Å•„ÅÑ„ÅüÁû¨Èñì

„ÅÇ„ÇãÊó•„ÄÅ„É°„É´„Éû„Ç¨Êõ∏„Åè„ÅÆ„ÅåÈù¢ÂÄí„Åß
ChatGPT„Å´„Äå**„É°„É´„Éû„Ç¨„ÅÆËøî‰ø°Êñá‰Ωú„Å£„Å¶**„Äç„Å£„Å¶Êäï„Åí„Åæ„Åó„Åü„ÄÇ

Ê©üËÉΩ„Å™„Çì„Å¶‰Ωï„ÇÇÁü•„Çâ„Å™„ÅÑ„Åæ„Åæ„ÄÇ

**5ÂàÜ„ÅßÂÆåÊàê„ÄÇ„Åó„Åã„ÇÇËá™ÂàÜ„Çà„ÇäË™≠„Åø„ÇÑ„Åô„ÅÑ„ÄÇ**

„Äå„Åà„ÄÅ„Åì„Çå„Åß„Çà„Åè„Å™„ÅÑÔºü„Äç`;

        // „Ç´„É©„Éº„Éë„É¨„ÉÉ„ÉàÂÆöÁæ©
        const colorPalettes = {
            gradients: [
                { name: 'Instagram', colors: ['#833ab4', '#fd1d1d'] },
                { name: '„Çµ„É≥„Çª„ÉÉ„Éà', colors: ['#ff6b6b', '#feca57'] },
                { name: '„Ç™„Éº„Ç∑„É£„É≥', colors: ['#667eea', '#764ba2'] },
                { name: '„Éï„Ç©„É¨„Çπ„Éà', colors: ['#38ef7d', '#11998e'] }
            ],
            solids: [
                { name: '„Éõ„ÉØ„Ç§„Éà', color: '#ffffff' },
                { name: '„Éñ„É©„ÉÉ„ÇØ', color: '#1a1a1a' },
                { name: '„Ç∞„É¨„Éº', color: '#f5f5f5' },
                { name: '„Éç„Ç§„Éì„Éº', color: '#2c3e50' }
            ]
        };

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            previewSlideCount();
        });

        // „Ç¢„Çπ„Éö„ÇØ„ÉàÊØîÊõ¥Êñ∞
        function updateAspectRatio() {
            aspectRatio = document.getElementById('aspectRatio').value;
            const previewFrame = document.getElementById('previewFrame');
            
            switch (aspectRatio) {
                case '9:16':
                    previewFrame.style.aspectRatio = '9 / 16';
                    break;
                case '1:1':
                    previewFrame.style.aspectRatio = '1 / 1';
                    break;
                case '16:9':
                    previewFrame.style.aspectRatio = '16 / 9';
                    break;
                case '4:5':
                default:
                    previewFrame.style.aspectRatio = '4 / 5';
                    break;
            }
        }

        // „Çµ„É≥„Éó„É´Ë™≠„ÅøËæº„Åø
        function loadSample() {
            document.getElementById('markdownInput').value = sampleMarkdown;
            previewSlideCount();
        }

        // ÂÖ•Âäõ„ÇØ„É™„Ç¢
        function clearInput() {
            document.getElementById('markdownInput').value = '';
            slidesData = [];
            totalSlides = 0;
            currentSlide = 1;
            updateUI();
            previewSlideCount();
        }

        // „Çπ„É©„Ç§„ÉâÊï∞„Éó„É¨„Éì„É•„Éº
        function previewSlideCount() {
            const markdownText = document.getElementById('markdownInput').value.trim();
            if (!markdownText) {
                document.getElementById('slideCount').textContent = '0';
                return;
            }

            const parsedSlides = parseMarkdownToSlides(markdownText);
            document.getElementById('slideCount').textContent = Math.min(parsedSlides.length, 20);
        }

        // „Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„Çí„Éë„Éº„Çπ„Åó„Å¶„Çπ„É©„Ç§„Éâ„Å´ÂàÜÂâ≤
        function parseMarkdownToSlides(markdownText) {
            const lines = markdownText.split('\n');
            const slides = [];
            let currentSlideData = null;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // ## „ÅßÂßã„Åæ„ÇãË°åÔºàÊñ∞„Åó„ÅÑ„Çπ„É©„Ç§„ÉâÔºâ
                if (line.startsWith('## ')) {
                    if (currentSlideData) {
                        slides.push(currentSlideData);
                    }
                    currentSlideData = {
                        title: line.substring(3).trim(),
                        body: ''
                    };
                }
                // ### „ÅßÂßã„Åæ„ÇãË°åÔºàÂ∞èË¶ãÂá∫„Åó - Êú¨Êñá„Å®„Åó„Å¶ËøΩÂä†Ôºâ
                else if (line.startsWith('### ')) {
                    if (currentSlideData) {
                        const subheading = line.substring(4).trim();
                        if (currentSlideData.body) {
                            currentSlideData.body += '\n\n**' + subheading + '**';
                        } else {
                            currentSlideData.body = '**' + subheading + '**';
                        }
                    }
                }
                // Êú¨Êñá„Å´ËøΩÂä†
                else if (currentSlideData) {
                    if (line === '') {
                        if (currentSlideData.body) {
                            currentSlideData.body += '\n';
                        }
                    } else {
                        if (currentSlideData.body) {
                            currentSlideData.body += '\n' + line;
                        } else {
                            currentSlideData.body = line;
                        }
                    }
                }
            }

            // ÊúÄÂæå„ÅÆ„Çπ„É©„Ç§„Éâ„ÇíËøΩÂä†
            if (currentSlideData) {
                slides.push(currentSlideData);
            }

            return slides.slice(0, 20);
        }

        // „Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„Çí„Éë„Éº„Çπ
        function parseMarkdown() {
            const markdownText = document.getElementById('markdownInput').value.trim();
            if (!markdownText) {
                alert('„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const parsedSlides = parseMarkdownToSlides(markdownText);
            
            if (parsedSlides.length === 0) {
                alert('„Çπ„É©„Ç§„Éâ„ÇíÁîüÊàê„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ## „Åß„Çπ„É©„Ç§„Éâ„ÇíÂå∫Âàá„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            // „Çπ„É©„Ç§„Éâ„Éá„Éº„Çø„ÇíÂàùÊúüÂåñ
            slidesData = parsedSlides.map(slide => ({
                ...slide,
                backgroundColor: { type: 'gradient', colors: ['#667eea', '#764ba2'] },
                layout: { verticalAlign: 'center', textAlign: 'center' },
                fontSize: { titleSize: 68, bodySize: 44 }
            }));

            totalSlides = slidesData.length;
            currentSlide = 1;

            // UIÊõ¥Êñ∞
            updateUI();
            showGenerationResult();
        }

        // UIÊõ¥Êñ∞
        function updateUI() {
            updatePreview();
            updateNavigationControls();
            updateEditControls();
        }

        // „Éó„É¨„Éì„É•„ÉºÊõ¥Êñ∞
        function updatePreview() {
            const previewContent = document.getElementById('previewContent');
            
            if (totalSlides === 0) {
                previewContent.innerHTML = '<div>„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
                return;
            }

            const slide = slidesData[currentSlide - 1];
            
            // „Éó„É¨„Éì„É•„ÉºÁî®„ÅÆÁ∞°ÊòìË°®Á§∫
            let html = `
                <div style="padding: 20px;">
                    <h3 style="font-size: 18px; margin-bottom: 10px;">${slide.title}</h3>
                    <div style="font-size: 14px; line-height: 1.6;">${slide.body.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            
            previewContent.innerHTML = html;
        }

        // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Êõ¥Êñ∞
        function updateNavigationControls() {
            const navControls = document.getElementById('navigationControls');
            const generateButton = document.getElementById('generateImagesButton');
            const editSection = document.getElementById('editSection');
            
            if (totalSlides > 0) {
                navControls.style.display = 'flex';
                generateButton.style.display = 'block';
                editSection.style.display = 'block';
                
                document.getElementById('currentSlide').textContent = currentSlide;
                document.getElementById('totalSlides').textContent = totalSlides;
                
                document.getElementById('prevButton').disabled = currentSlide === 1;
                document.getElementById('nextButton').disabled = currentSlide === totalSlides;
            } else {
                navControls.style.display = 'none';
                generateButton.style.display = 'none';
                editSection.style.display = 'none';
            }
        }

        // Á∑®ÈõÜ„Ç≥„É≥„Éà„É≠„Éº„É´Êõ¥Êñ∞
        function updateEditControls() {
            if (totalSlides === 0) return;
            
            const slide = slidesData[currentSlide - 1];
            
            document.getElementById('editTitle').value = slide.title || '';
            document.getElementById('editBody').value = slide.body || '';
            document.getElementById('currentSlideBadge').textContent = currentSlide;
            
            updateColorPalette();
            updateLayoutControls();
            updateFontSizeControls();
        }

        // „Ç´„É©„Éº„Éë„É¨„ÉÉ„ÉàÊõ¥Êñ∞
        function updateColorPalette() {
            const slide = slidesData[currentSlide - 1];
            const palette = document.getElementById('colorPalette');
            
            let html = '<span class="color-label">„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥:</span>';
            colorPalettes.gradients.forEach((gradient, index) => {
                const isSelected = slide.backgroundColor.type === 'gradient' && 
                                 slide.backgroundColor.colors[0] === gradient.colors[0];
                html += `
                    <div class="color-option gradient ${isSelected ? 'selected' : ''}" 
                         style="--color1: ${gradient.colors[0]}; --color2: ${gradient.colors[1]};"
                         onclick="selectColor('gradient', ['${gradient.colors[0]}', '${gradient.colors[1]}'])"
                         title="${gradient.name}">
                    </div>
                `;
            });
            
            html += '<span class="color-label" style="margin-left: 8px;">ÂçòËâ≤:</span>';
            colorPalettes.solids.forEach((solid, index) => {
                const isSelected = slide.backgroundColor.type === 'solid' && 
                                 slide.backgroundColor.color === solid.color;
                html += `
                    <div class="color-option ${isSelected ? 'selected' : ''}" 
                         style="background: ${solid.color}; ${solid.color === '#ffffff' ? 'border: 1px solid #ddd;' : ''}"
                         onclick="selectColor('solid', '${solid.color}')"
                         title="${solid.name}">
                    </div>
                `;
            });
            
            palette.innerHTML = html;
        }

        // „É¨„Ç§„Ç¢„Ç¶„Éà„Ç≥„É≥„Éà„É≠„Éº„É´Êõ¥Êñ∞
        function updateLayoutControls() {
            const slide = slidesData[currentSlide - 1];
            const layout = slide.layout;
            const controls = document.getElementById('layoutControls');
            
            controls.innerHTML = `
                <div class="layout-group">
                    <label>Á∏¶ÈÖçÁΩÆ</label>
                    <div class="layout-options">
                        <div class="layout-option ${layout.verticalAlign === 'top' ? 'selected' : ''}" 
                             onclick="selectLayout('verticalAlign', 'top')">‚Üë</div>
                        <div class="layout-option ${layout.verticalAlign === 'center' ? 'selected' : ''}" 
                             onclick="selectLayout('verticalAlign', 'center')">‚óè</div>
                        <div class="layout-option ${layout.verticalAlign === 'bottom' ? 'selected' : ''}" 
                             onclick="selectLayout('verticalAlign', 'bottom')">‚Üì</div>
                    </div>
                </div>
                <div class="layout-group">
                    <label>Ê®™ÈÖçÁΩÆ</label>
                    <div class="layout-options">
                        <div class="layout-option ${layout.textAlign === 'left' ? 'selected' : ''}" 
                             onclick="selectLayout('textAlign', 'left')">‚Üê</div>
                        <div class="layout-option ${layout.textAlign === 'center' ? 'selected' : ''}" 
                             onclick="selectLayout('textAlign', 'center')">‚óè</div>
                        <div class="layout-option ${layout.textAlign === 'right' ? 'selected' : ''}" 
                             onclick="selectLayout('textAlign', 'right')">‚Üí</div>
                    </div>
                </div>
            `;
        }

        // „Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„Ç≥„É≥„Éà„É≠„Éº„É´Êõ¥Êñ∞
        function updateFontSizeControls() {
            const slide = slidesData[currentSlide - 1];
            
            document.getElementById('titleSize').value = slide.fontSize.titleSize;
            document.getElementById('titleSizeValue').textContent = slide.fontSize.titleSize + 'px';
            
            document.getElementById('bodySize').value = slide.fontSize.bodySize;
            document.getElementById('bodySizeValue').textContent = slide.fontSize.bodySize + 'px';
        }

        // ÁîüÊàêÁµêÊûúË°®Á§∫
        function showGenerationResult() {
            alert(`‚úÖ ${totalSlides}Êûö„ÅÆ„Çπ„É©„Ç§„Éâ„ÇíÁîüÊàê„Åó„Åæ„Åó„ÅüÔºÅ`);
        }

        // „Çπ„É©„Ç§„ÉâÂÜÖÂÆπÊõ¥Êñ∞
        function updateSlideContent(field) {
            if (totalSlides === 0) return;
            
            const slide = slidesData[currentSlide - 1];
            
            if (field === 'title') {
                slide.title = document.getElementById('editTitle').value;
            } else if (field === 'body') {
                slide.body = document.getElementById('editBody').value;
            }
            
            updatePreview();
        }

        // „Ç´„É©„ÉºÈÅ∏Êäû
        function selectColor(type, colorData) {
            if (totalSlides === 0) return;
            
            if (type === 'gradient') {
                slidesData[currentSlide - 1].backgroundColor = {
                    type: 'gradient',
                    colors: colorData
                };
            } else {
                slidesData[currentSlide - 1].backgroundColor = {
                    type: 'solid',
                    color: colorData
                };
            }
            
            updatePreview();
            updateColorPalette();
        }

        // „É¨„Ç§„Ç¢„Ç¶„ÉàÈÅ∏Êäû
        function selectLayout(property, value) {
            if (totalSlides === 0) return;
            
            slidesData[currentSlide - 1].layout[property] = value;
            updatePreview();
            updateLayoutControls();
        }

        // „Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫Êõ¥Êñ∞
        function updateFontSize(property, value) {
            if (totalSlides === 0) return;
            
            slidesData[currentSlide - 1].fontSize[property] = parseInt(value);
            
            const valueElement = document.getElementById(property + 'Value');
            if (valueElement) {
                valueElement.textContent = value + 'px';
            }
            
            updatePreview();
        }

        // Ââç„ÅÆ„Çπ„É©„Ç§„Éâ
        function previousSlide() {
            if (currentSlide > 1) {
                currentSlide--;
                updateUI();
            }
        }

        // Ê¨°„ÅÆ„Çπ„É©„Ç§„Éâ
        function nextSlide() {
            if (currentSlide < totalSlides) {
                currentSlide++;
                updateUI();
            }
        }

        // „Çπ„É©„Ç§„ÉâËøΩÂä†
        function addSlide() {
            if (totalSlides >= 20) {
                alert('ÊúÄÂ§ß20Êûö„Åæ„ÅßËøΩÂä†„Åß„Åç„Åæ„Åô');
                return;
            }
            
            const newSlide = {
                title: `Êñ∞„Åó„ÅÑ„Çπ„É©„Ç§„Éâ ${totalSlides + 1}`,
                body: '',
                backgroundColor: { type: 'solid', color: '#ffffff' },
                layout: { verticalAlign: 'top', textAlign: 'left' },
                fontSize: { titleSize: 68, bodySize: 44 }
            };
            
            slidesData.splice(currentSlide, 0, newSlide);
            totalSlides = slidesData.length;
            currentSlide++;
            
            updateUI();
            alert(`‚úÖ „Çπ„É©„Ç§„Éâ ${currentSlide} „ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ`);
        }

        // ÁèæÂú®„ÅÆ„Çπ„É©„Ç§„Éâ„ÇíÂâäÈô§
        function deleteCurrentSlide() {
            if (totalSlides <= 1) {
                alert('ÊúÄÂæå„ÅÆ„Çπ„É©„Ç§„Éâ„ÅØÂâäÈô§„Åß„Åç„Åæ„Åõ„Çì');
                return;
            }
            
            if (!confirm(`„Çπ„É©„Ç§„Éâ ${currentSlide} „ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)) {
                return;
            }
            
            slidesData.splice(currentSlide - 1, 1);
            totalSlides = slidesData.length;
            
            if (currentSlide > totalSlides) {
                currentSlide = totalSlides;
            }
            
            updateUI();
            alert(`‚úÖ „Çπ„É©„Ç§„Éâ„ÇíÂâäÈô§„Åó„Åæ„Åó„ÅüÔºÅÔºàÊÆã„Çä${totalSlides}ÊûöÔºâ`);
        }

        // ÁîªÂÉèÁîüÊàê
        async function generateImages() {
            if (totalSlides === 0) {
                alert('„Åæ„Åö„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„ÇíÂÖ•Âäõ„Åó„Å¶„Çπ„É©„Ç§„Éâ„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            document.getElementById('loading').classList.add('active');

            const canvases = [];
            for (let i = 1; i <= totalSlides; i++) {
                const canvas = await generateSlideCanvas(i);
                canvases.push(canvas);
            }

            document.getElementById('loading').classList.remove('active');
            showDownloadModal(canvases);
        }

        // „Çπ„É©„Ç§„Éâ„ÇíCanvas„ÅßÁîüÊàêÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
        async function generateSlideCanvas(slideNum) {
            const canvas = document.createElement('canvas');
            
            // „Ç¢„Çπ„Éö„ÇØ„ÉàÊØî„Å´Âøú„Åò„Å¶Ëß£ÂÉèÂ∫¶„ÇíË®≠ÂÆö
            switch (aspectRatio) {
                case '9:16':
                    canvas.width = 1080;
                    canvas.height = 1920;
                    break;
                case '1:1':
                    canvas.width = 1080;
                    canvas.height = 1080;
                    break;
                case '16:9':
                    canvas.width = 1920;
                    canvas.height = 1080;
                    break;
                case '4:5':
                default:
                    canvas.width = 1080;
                    canvas.height = 1350;
                    break;
            }
            
            const ctx = canvas.getContext('2d');
            const slide = slidesData[slideNum - 1];
            
            // ËÉåÊôØÊèèÁîª
            const bg = slide.backgroundColor;
            if (bg.type === 'gradient') {
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, bg.colors[0]);
                gradient.addColorStop(1, bg.colors[1]);
                ctx.fillStyle = gradient;
            } else {
                ctx.fillStyle = bg.color;
            }
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // „ÉÜ„Ç≠„Çπ„ÉàËâ≤„ÅÆÊ±∫ÂÆö
            let textColor = '#333';
            if (bg.type === 'gradient' || bg.color === '#1a1a1a' || bg.color === '#2c3e50') {
                textColor = '#fff';
            }
            
            const padding = 120;
            const layout = slide.layout;
            const fontSize = slide.fontSize;
            
            // „Çø„Ç§„Éà„É´ÊèèÁîª
            ctx.fillStyle = textColor;
            ctx.font = `bold ${fontSize.titleSize}px "Noto Sans JP", sans-serif`;
            ctx.textAlign = layout.textAlign;
            
            let titleX;
            if (layout.textAlign === 'center') {
                titleX = canvas.width / 2;
            } else if (layout.textAlign === 'right') {
                titleX = canvas.width - padding;
            } else {
                titleX = padding;
            }
            
            let titleY;
            if (layout.verticalAlign === 'center') {
                titleY = canvas.height / 2 - 100;
            } else if (layout.verticalAlign === 'bottom') {
                titleY = canvas.height - 300;
            } else {
                titleY = 200;
            }
            
            // „Çø„Ç§„Éà„É´„ÇíÊèèÁîªÔºà„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Ë®òÊ≥ï„ÇíÂâäÈô§Ôºâ
            const cleanTitle = removeMarkdown(slide.title);
            ctx.fillText(cleanTitle, titleX, titleY);
            
            // Êú¨ÊñáÊèèÁîª
            if (slide.body) {
                ctx.font = `${fontSize.bodySize}px "Noto Sans JP", sans-serif`;
                ctx.fillStyle = textColor;
                ctx.textAlign = layout.textAlign;
                
                let bodyY = titleY + fontSize.titleSize + 60;
                
                // Êú¨Êñá„ÇíË°å„Åî„Å®„Å´ÊèèÁîªÔºà„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Ë®òÊ≥ï„ÇíÂâäÈô§Ôºâ
                const cleanBody = removeMarkdown(slide.body);
                const bodyLines = cleanBody.split('\n');
                
                for (let line of bodyLines) {
                    if (line.trim()) {
                        ctx.fillText(line, titleX, bodyY);
                        bodyY += fontSize.bodySize * 1.5;
                    } else {
                        bodyY += fontSize.bodySize * 0.5; // Á©∫Ë°å
                    }
                    
                    // ÁîªÈù¢Â§ñ„Å´Âá∫„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
                    if (bodyY > canvas.height - 100) break;
                }
            }
            
            // „Çπ„É©„Ç§„ÉâÁï™Âè∑ÔºàÊúÄÂæå‰ª•Â§ñÔºâ
            if (slideNum < totalSlides) {
                ctx.font = '24px sans-serif';
                ctx.fillStyle = textColor;
                ctx.globalAlpha = 0.5;
                ctx.textAlign = 'right';
                ctx.fillText('Á∂ö„Åè ‚Üí', canvas.width - padding, canvas.height - 60);
                ctx.globalAlpha = 1;
            }
            
            return canvas;
        }

        // „Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Ë®òÊ≥ï„ÇíÂâäÈô§
        function removeMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '$1') // **Â§™Â≠ó**
                .replace(/\*(.*?)\*/g, '$1')     // *Êñú‰Ωì*
                .replace(/~~(.*?)~~/g, '$1')     // ~~Âèñ„ÇäÊ∂à„ÅóÁ∑ö~~
                .replace(/`(.*?)`/g, '$1')       // `„Ç≥„Éº„Éâ`
                .replace(/__(.*?)__/g, '$1')     // __Â§™Â≠ó__
                .replace(/_(.*?)_/g, '$1')       // _Êñú‰Ωì_
                .replace(/<[^>]+>/g, '');        // HTML„Çø„Ç∞
        }

        // „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        function showDownloadModal(canvases) {
            const modal = document.getElementById('downloadModal');
            const grid = document.getElementById('downloadGrid');
            
            grid.innerHTML = '';
            canvases.forEach((canvas, index) => {
                const div = document.createElement('div');
                div.className = 'download-item';
                div.textContent = `${index + 1}`;
                div.onclick = () => downloadImage(canvas, index + 1);
                grid.appendChild(div);
            });
            
            window.generatedCanvases = canvases;
            modal.classList.add('active');
        }

        // ÂÄãÂà•ÁîªÂÉè„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        function downloadImage(canvas, slideNum) {
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `„Çπ„É©„Ç§„Éâ${String(slideNum).padStart(2, '0')}.png`;
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        // „Åô„Åπ„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        function downloadAll() {
            if (window.generatedCanvases) {
                window.generatedCanvases.forEach((canvas, index) => {
                    setTimeout(() => {
                        downloadImage(canvas, index + 1);
                    }, index * 200);
                });
            }
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeModal() {
            document.getElementById('downloadModal').classList.remove('active');
        }
    </script>
</body>
</html>