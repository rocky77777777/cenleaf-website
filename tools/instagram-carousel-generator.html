<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagramç”»åƒä½œæˆãƒ„ãƒ¼ãƒ« | é ˆå´ã‚¹ã‚¿ã‚¤ãƒ«</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>ğŸ“±</text></svg>" type="image/svg+xml">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }


        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 700px;
        }

        .input-section {
            width: 400px;
            padding: 30px;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: 80vh;
        }

        .preview-section {
            flex: 1;
            padding: 30px;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .edit-section {
            width: 350px;
            padding: 30px;
            background: #fafafa;
            border-left: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: 80vh;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-weight: bold;
            font-size: 12px;
        }

        .step-title {
            font-size: 14px;
            font-weight: bold;
        }

        select {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            background: white;
            margin-bottom: 15px;
        }

        textarea {
            width: 100%;
            height: 350px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            resize: vertical;
            font-family: 'Noto Sans JP', monospace;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        button {
            padding: 10px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button.secondary {
            background: #e0e0e0;
            color: #333;
        }

        button.secondary:hover {
            background: #d0d0d0;
        }

        .slide-counter {
            margin-top: 8px;
            text-align: center;
            color: #666;
            font-size: 12px;
        }

        .preview-frame {
            width: 270px;
            height: 338px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 15px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .preview-content {
            padding: 20px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            font-size: 12px;
            line-height: 1.6;
        }

        .navigation-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .nav-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .nav-button:hover {
            background: #667eea;
            color: white;
        }

        .nav-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .slide-indicator {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            min-width: 60px;
            text-align: center;
        }

        .generate-button {
            width: 100%;
            padding: 14px;
            margin-top: 20px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            font-size: 15px;
        }

        .edit-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .edit-panel h3 {
            font-size: 14px;
            margin-bottom: 12px;
            color: #333;
        }

        .edit-control {
            margin-bottom: 15px;
        }

        .edit-control label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .edit-control input,
        .edit-control textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px;
        }

        .edit-control textarea {
            height: 100px;
            resize: vertical;
        }

        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .color-option.gradient {
            background: linear-gradient(135deg, var(--color1) 0%, var(--color2) 100%);
        }

        .color-label {
            font-size: 11px;
            color: #666;
            margin-right: 5px;
        }

        .layout-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layout-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .layout-group label {
            font-size: 12px;
            color: #666;
        }

        .layout-options {
            display: flex;
            gap: 5px;
        }

        .layout-option {
            width: 32px;
            height: 32px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .layout-option:hover {
            border-color: #667eea;
        }

        .layout-option.selected {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .font-size-control {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .size-slider {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .size-slider label {
            font-size: 11px;
            color: #666;
            min-width: 60px;
        }

        .size-slider input[type="range"] {
            flex: 1;
        }

        .size-value {
            font-size: 11px;
            color: #667eea;
            min-width: 40px;
            text-align: right;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .action-button {
            flex: 1;
            padding: 8px;
            font-size: 12px;
        }

        .success-badge {
            background: #48bb78;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-left: 8px;
        }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .loading.active {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .download-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .download-modal.active {
            display: flex;
        }

        .download-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .download-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .download-header h2 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .download-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .download-item {
            aspect-ratio: 1;
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
            font-weight: bold;
        }

        .download-item:hover {
            background: #667eea;
            color: white;
        }

        .download-actions {
            display: flex;
            gap: 10px;
        }

        .download-actions button {
            flex: 1;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .input-section,
            .edit-section {
                width: 100%;
                max-width: 100%;
                border: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± Instagramç”»åƒä½œæˆãƒ„ãƒ¼ãƒ«</h1>
            <p>æ–‡ç« ã‚’å…¥åŠ›ã™ã‚‹ã ã‘ã§ã€ãƒ—ãƒ­ä»•æ§˜ã®InstagramæŠ•ç¨¿ç”»åƒã‚’è‡ªå‹•ä½œæˆ<br>ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã§æ–‡ç« ã‚’å…¥ã‚Œã‚‹ã ã‘ã§ã‚«ãƒ«ãƒ¼ã‚»ãƒ«æŠ•ç¨¿ãŒã‚µã‚¯ãƒƒã¨ã§ãã‚‹</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’é¸æŠ</div>
                </div>
                <select id="aspectRatio" onchange="updateAspectRatio()">
                    <option value="4:5">4:5 (ç¸¦å‹ãƒ»æ¨å¥¨)</option>
                    <option value="9:16">9:16 (ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚º)</option>
                    <option value="1:1">1:1 (æ­£æ–¹å½¢)</option>
                    <option value="16:9">16:9 (æ¨ªå‹)</option>
                </select>

                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã§å†…å®¹ã‚’å…¥åŠ›</div>
                </div>
                <textarea id="markdownInput" placeholder="# ã‚¿ã‚¤ãƒˆãƒ«

## ã‚¹ãƒ©ã‚¤ãƒ‰1ã®ã‚¿ã‚¤ãƒˆãƒ«
æœ¬æ–‡ãƒ†ã‚­ã‚¹ãƒˆ

## ã‚¹ãƒ©ã‚¤ãƒ‰2ã®ã‚¿ã‚¤ãƒˆãƒ«
æœ¬æ–‡ãƒ†ã‚­ã‚¹ãƒˆ" oninput="previewSlideCount()"></textarea>
                
                <div class="slide-counter">
                    äºˆæƒ³ã‚¹ãƒ©ã‚¤ãƒ‰æ•°: <span id="slideCount">0</span>æš
                </div>

                <div class="button-group">
                    <button onclick="loadSample()">ã‚µãƒ³ãƒ—ãƒ«èª­è¾¼</button>
                    <button onclick="clearInput()" class="secondary">ã‚¯ãƒªã‚¢</button>
                </div>

                <button onclick="parseMarkdown()" class="generate-button">
                    ãƒ‘ãƒ¼ã‚¹ã—ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆ
                </button>
            </div>

            <div class="preview-section">
                <h3 style="font-size: 14px; margin-bottom: 10px;">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                
                <div class="preview-frame" id="previewFrame">
                    <div class="preview-content" id="previewContent">
                        ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                    </div>
                </div>

                <div class="navigation-controls" id="navigationControls" style="display: none;">
                    <button class="nav-button" onclick="previousSlide()" id="prevButton">â†</button>
                    <div class="slide-indicator">
                        <span id="currentSlide">1</span> / <span id="totalSlides">1</span>
                    </div>
                    <button class="nav-button" onclick="nextSlide()" id="nextButton">â†’</button>
                </div>

                <button onclick="generateImages()" class="generate-button" id="generateImagesButton" style="display: none;">
                    ğŸ“¸ ç”»åƒã‚’ç”Ÿæˆã™ã‚‹
                </button>
            </div>

            <div class="edit-section" id="editSection" style="display: none;">
                <div class="edit-panel" id="editPanels">
                    <h3>ã‚¹ãƒ©ã‚¤ãƒ‰ç·¨é›† <span id="currentSlideBadge" class="success-badge">1</span></h3>
                    
                    <div class="edit-control">
                        <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
                        <input type="text" id="editTitle" onchange="updateSlideContent('title')">
                    </div>

                    <div class="edit-control">
                        <label>æœ¬æ–‡</label>
                        <textarea id="editBody" onchange="updateSlideContent('body')"></textarea>
                    </div>

                    <div class="edit-control">
                        <label>èƒŒæ™¯è‰²</label>
                        <div class="color-palette" id="colorPalette"></div>
                    </div>

                    <div class="edit-control">
                        <label>ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</label>
                        <div class="layout-controls" id="layoutControls"></div>
                    </div>

                    <div class="edit-control">
                        <label>æ–‡å­—ã‚µã‚¤ã‚º</label>
                        <div class="font-size-control">
                            <div class="size-slider">
                                <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
                                <input type="range" id="titleSize" min="40" max="120" value="68" 
                                       onchange="updateFontSize('titleSize', this.value)">
                                <span class="size-value" id="titleSizeValue">68px</span>
                            </div>
                            <div class="size-slider">
                                <label>æœ¬æ–‡</label>
                                <input type="range" id="bodySize" min="20" max="80" value="44" 
                                       onchange="updateFontSize('bodySize', this.value)">
                                <span class="size-value" id="bodySizeValue">44px</span>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button onclick="addSlide()" class="action-button">ã‚¹ãƒ©ã‚¤ãƒ‰è¿½åŠ </button>
                        <button onclick="deleteCurrentSlide()" class="action-button secondary">å‰Šé™¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>ç”»åƒã‚’ç”Ÿæˆä¸­...</p>
        </div>
    </div>

    <div class="download-modal" id="downloadModal">
        <div class="download-content">
            <div class="download-header">
                <h2>ğŸ‰ ç”»åƒç”Ÿæˆå®Œäº†ï¼</h2>
                <p>ã‚¯ãƒªãƒƒã‚¯ã—ã¦å€‹åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>
            </div>
            <div class="download-grid" id="downloadGrid"></div>
            <div class="download-actions">
                <button onclick="downloadAll()">ã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                <button onclick="closeModal()" class="secondary">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let slidesData = [];
        let currentSlide = 1;
        let totalSlides = 0;
        let aspectRatio = '4:5';

        // ã‚µãƒ³ãƒ—ãƒ«ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³
        const sampleMarkdown = `## ã€ŒAIã®æ©Ÿèƒ½ã‚’è¦šãˆã‚‹ã€ãªã‚“ã¦æ™‚é–“ã®ãƒ ãƒ€ã ã£ãŸè©±

æ­£ç›´è¨€ã„ã¾ã™ã€‚
**AIå‹‰å¼·ä¼šã¨ã‹è¡Œã‹ãªãã¦ã„ã„**ã§ã™ã€‚

åƒ•ã‚‚3å¹´å‰ã¯åŒã˜ã§ã—ãŸã€‚
- åˆ†åšã„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«èª­ã‚“ã§
- YouTubeå‹•ç”»è¦‹ã¾ãã£ã¦  
- æœ‰æ–™ã‚»ãƒŸãƒŠãƒ¼å—ã‘ã¦

ã§ã‚‚3ãƒ¶æœˆå¾Œ...
**ChatGPTãŒå¤§å‹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦è¦šãˆãŸæ©Ÿèƒ½ã®åŠåˆ†ãŒæ¶ˆãˆã¦ãŸ**

ã‚ã®å‹‰å¼·æ™‚é–“ã€ãªã‚“ã ã£ãŸã®ï¼Ÿ

## æ°—ã¥ã„ãŸç¬é–“

ã‚ã‚‹æ—¥ã€ãƒ¡ãƒ«ãƒã‚¬æ›¸ãã®ãŒé¢å€’ã§
ChatGPTã«ã€Œ**ãƒ¡ãƒ«ãƒã‚¬ã®è¿”ä¿¡æ–‡ä½œã£ã¦**ã€ã£ã¦æŠ•ã’ã¾ã—ãŸã€‚

æ©Ÿèƒ½ãªã‚“ã¦ä½•ã‚‚çŸ¥ã‚‰ãªã„ã¾ã¾ã€‚

**5åˆ†ã§å®Œæˆã€‚ã—ã‹ã‚‚è‡ªåˆ†ã‚ˆã‚Šèª­ã¿ã‚„ã™ã„ã€‚**

ã€Œãˆã€ã“ã‚Œã§ã‚ˆããªã„ï¼Ÿã€`;

        // ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆå®šç¾©
        const colorPalettes = {
            gradients: [
                { name: 'Instagram', colors: ['#833ab4', '#fd1d1d'] },
                { name: 'ã‚µãƒ³ã‚»ãƒƒãƒˆ', colors: ['#ff6b6b', '#feca57'] },
                { name: 'ã‚ªãƒ¼ã‚·ãƒ£ãƒ³', colors: ['#667eea', '#764ba2'] },
                { name: 'ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆ', colors: ['#38ef7d', '#11998e'] }
            ],
            solids: [
                { name: 'ãƒ›ãƒ¯ã‚¤ãƒˆ', color: '#ffffff' },
                { name: 'ãƒ–ãƒ©ãƒƒã‚¯', color: '#1a1a1a' },
                { name: 'ã‚°ãƒ¬ãƒ¼', color: '#f5f5f5' },
                { name: 'ãƒã‚¤ãƒ“ãƒ¼', color: '#2c3e50' }
            ]
        };

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            previewSlideCount();
        });

        // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”æ›´æ–°
        function updateAspectRatio() {
            aspectRatio = document.getElementById('aspectRatio').value;
            const previewFrame = document.getElementById('previewFrame');
            
            switch (aspectRatio) {
                case '9:16':
                    previewFrame.style.aspectRatio = '9 / 16';
                    break;
                case '1:1':
                    previewFrame.style.aspectRatio = '1 / 1';
                    break;
                case '16:9':
                    previewFrame.style.aspectRatio = '16 / 9';
                    break;
                case '4:5':
                default:
                    previewFrame.style.aspectRatio = '4 / 5';
                    break;
            }
        }

        // ã‚µãƒ³ãƒ—ãƒ«èª­ã¿è¾¼ã¿
        function loadSample() {
            document.getElementById('markdownInput').value = sampleMarkdown;
            previewSlideCount();
        }

        // å…¥åŠ›ã‚¯ãƒªã‚¢
        function clearInput() {
            document.getElementById('markdownInput').value = '';
            slidesData = [];
            totalSlides = 0;
            currentSlide = 1;
            updateUI();
            previewSlideCount();
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        function previewSlideCount() {
            const markdownText = document.getElementById('markdownInput').value.trim();
            if (!markdownText) {
                document.getElementById('slideCount').textContent = '0';
                return;
            }

            const parsedSlides = parseMarkdownToSlides(markdownText);
            document.getElementById('slideCount').textContent = Math.min(parsedSlides.length, 20);
        }

        // ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ã«åˆ†å‰²
        function parseMarkdownToSlides(markdownText) {
            const lines = markdownText.split('\n');
            const slides = [];
            let currentSlideData = null;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // ## ã§å§‹ã¾ã‚‹è¡Œï¼ˆæ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ï¼‰
                if (line.startsWith('## ')) {
                    if (currentSlideData) {
                        slides.push(currentSlideData);
                    }
                    currentSlideData = {
                        title: line.substring(3).trim(),
                        body: ''
                    };
                }
                // ### ã§å§‹ã¾ã‚‹è¡Œï¼ˆå°è¦‹å‡ºã— - æœ¬æ–‡ã¨ã—ã¦è¿½åŠ ï¼‰
                else if (line.startsWith('### ')) {
                    if (currentSlideData) {
                        const subheading = line.substring(4).trim();
                        if (currentSlideData.body) {
                            currentSlideData.body += '\n\n**' + subheading + '**';
                        } else {
                            currentSlideData.body = '**' + subheading + '**';
                        }
                    }
                }
                // æœ¬æ–‡ã«è¿½åŠ 
                else if (currentSlideData) {
                    if (line === '') {
                        if (currentSlideData.body) {
                            currentSlideData.body += '\n';
                        }
                    } else {
                        if (currentSlideData.body) {
                            currentSlideData.body += '\n' + line;
                        } else {
                            currentSlideData.body = line;
                        }
                    }
                }
            }

            // æœ€å¾Œã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¿½åŠ 
            if (currentSlideData) {
                slides.push(currentSlideData);
            }

            return slides.slice(0, 20);
        }

        // ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’ãƒ‘ãƒ¼ã‚¹
        function parseMarkdown() {
            const markdownText = document.getElementById('markdownInput').value.trim();
            if (!markdownText) {
                alert('ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const parsedSlides = parseMarkdownToSlides(markdownText);
            
            if (parsedSlides.length === 0) {
                alert('ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚## ã§ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’åŒºåˆ‡ã£ã¦ãã ã•ã„ã€‚');
                return;
            }

            // ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
            slidesData = parsedSlides.map(slide => ({
                ...slide,
                backgroundColor: { type: 'gradient', colors: ['#667eea', '#764ba2'] },
                layout: { verticalAlign: 'center', textAlign: 'center' },
                fontSize: { titleSize: 68, bodySize: 44 }
            }));

            totalSlides = slidesData.length;
            currentSlide = 1;

            // UIæ›´æ–°
            updateUI();
            showGenerationResult();
        }

        // UIæ›´æ–°
        function updateUI() {
            updatePreview();
            updateNavigationControls();
            updateEditControls();
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
        function updatePreview() {
            const previewContent = document.getElementById('previewContent');
            
            if (totalSlides === 0) {
                previewContent.innerHTML = '<div>ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>';
                return;
            }

            const slide = slidesData[currentSlide - 1];
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®ç°¡æ˜“è¡¨ç¤º
            let html = `
                <div style="padding: 20px;">
                    <h3 style="font-size: 18px; margin-bottom: 10px;">${slide.title}</h3>
                    <div style="font-size: 14px; line-height: 1.6;">${slide.body.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            
            previewContent.innerHTML = html;
        }

        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
        function updateNavigationControls() {
            const navControls = document.getElementById('navigationControls');
            const generateButton = document.getElementById('generateImagesButton');
            const editSection = document.getElementById('editSection');
            
            if (totalSlides > 0) {
                navControls.style.display = 'flex';
                generateButton.style.display = 'block';
                editSection.style.display = 'block';
                
                document.getElementById('currentSlide').textContent = currentSlide;
                document.getElementById('totalSlides').textContent = totalSlides;
                
                document.getElementById('prevButton').disabled = currentSlide === 1;
                document.getElementById('nextButton').disabled = currentSlide === totalSlides;
            } else {
                navControls.style.display = 'none';
                generateButton.style.display = 'none';
                editSection.style.display = 'none';
            }
        }

        // ç·¨é›†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æ›´æ–°
        function updateEditControls() {
            if (totalSlides === 0) return;
            
            const slide = slidesData[currentSlide - 1];
            
            document.getElementById('editTitle').value = slide.title || '';
            document.getElementById('editBody').value = slide.body || '';
            document.getElementById('currentSlideBadge').textContent = currentSlide;
            
            updateColorPalette();
            updateLayoutControls();
            updateFontSizeControls();
        }

        // ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆæ›´æ–°
        function updateColorPalette() {
            const slide = slidesData[currentSlide - 1];
            const palette = document.getElementById('colorPalette');
            
            let html = '<span class="color-label">ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:</span>';
            colorPalettes.gradients.forEach((gradient, index) => {
                const isSelected = slide.backgroundColor.type === 'gradient' && 
                                 slide.backgroundColor.colors[0] === gradient.colors[0];
                html += `
                    <div class="color-option gradient ${isSelected ? 'selected' : ''}" 
                         style="--color1: ${gradient.colors[0]}; --color2: ${gradient.colors[1]};"
                         onclick="selectColor('gradient', ['${gradient.colors[0]}', '${gradient.colors[1]}'])"
                         title="${gradient.name}">
                    </div>
                `;
            });
            
            html += '<span class="color-label" style="margin-left: 8px;">å˜è‰²:</span>';
            colorPalettes.solids.forEach((solid, index) => {
                const isSelected = slide.backgroundColor.type === 'solid' && 
                                 slide.backgroundColor.color === solid.color;
                html += `
                    <div class="color-option ${isSelected ? 'selected' : ''}" 
                         style="background: ${solid.color}; ${solid.color === '#ffffff' ? 'border: 1px solid #ddd;' : ''}"
                         onclick="selectColor('solid', '${solid.color}')"
                         title="${solid.name}">
                    </div>
                `;
            });
            
            palette.innerHTML = html;
        }

        // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æ›´æ–°
        function updateLayoutControls() {
            const slide = slidesData[currentSlide - 1];
            const layout = slide.layout;
            const controls = document.getElementById('layoutControls');
            
            controls.innerHTML = `
                <div class="layout-group">
                    <label>ç¸¦é…ç½®</label>
                    <div class="layout-options">
                        <div class="layout-option ${layout.verticalAlign === 'top' ? 'selected' : ''}" 
                             onclick="selectLayout('verticalAlign', 'top')">â†‘</div>
                        <div class="layout-option ${layout.verticalAlign === 'center' ? 'selected' : ''}" 
                             onclick="selectLayout('verticalAlign', 'center')">â—</div>
                        <div class="layout-option ${layout.verticalAlign === 'bottom' ? 'selected' : ''}" 
                             onclick="selectLayout('verticalAlign', 'bottom')">â†“</div>
                    </div>
                </div>
                <div class="layout-group">
                    <label>æ¨ªé…ç½®</label>
                    <div class="layout-options">
                        <div class="layout-option ${layout.textAlign === 'left' ? 'selected' : ''}" 
                             onclick="selectLayout('textAlign', 'left')">â†</div>
                        <div class="layout-option ${layout.textAlign === 'center' ? 'selected' : ''}" 
                             onclick="selectLayout('textAlign', 'center')">â—</div>
                        <div class="layout-option ${layout.textAlign === 'right' ? 'selected' : ''}" 
                             onclick="selectLayout('textAlign', 'right')">â†’</div>
                    </div>
                </div>
            `;
        }

        // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æ›´æ–°
        function updateFontSizeControls() {
            const slide = slidesData[currentSlide - 1];
            
            document.getElementById('titleSize').value = slide.fontSize.titleSize;
            document.getElementById('titleSizeValue').textContent = slide.fontSize.titleSize + 'px';
            
            document.getElementById('bodySize').value = slide.fontSize.bodySize;
            document.getElementById('bodySizeValue').textContent = slide.fontSize.bodySize + 'px';
        }

        // ç”Ÿæˆçµæœè¡¨ç¤º
        function showGenerationResult() {
            alert(`âœ… ${totalSlides}æšã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼`);
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰å†…å®¹æ›´æ–°
        function updateSlideContent(field) {
            if (totalSlides === 0) return;
            
            const slide = slidesData[currentSlide - 1];
            
            if (field === 'title') {
                slide.title = document.getElementById('editTitle').value;
            } else if (field === 'body') {
                slide.body = document.getElementById('editBody').value;
            }
            
            updatePreview();
        }

        // ã‚«ãƒ©ãƒ¼é¸æŠ
        function selectColor(type, colorData) {
            if (totalSlides === 0) return;
            
            if (type === 'gradient') {
                slidesData[currentSlide - 1].backgroundColor = {
                    type: 'gradient',
                    colors: colorData
                };
            } else {
                slidesData[currentSlide - 1].backgroundColor = {
                    type: 'solid',
                    color: colorData
                };
            }
            
            updatePreview();
            updateColorPalette();
        }

        // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé¸æŠ
        function selectLayout(property, value) {
            if (totalSlides === 0) return;
            
            slidesData[currentSlide - 1].layout[property] = value;
            updatePreview();
            updateLayoutControls();
        }

        // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºæ›´æ–°
        function updateFontSize(property, value) {
            if (totalSlides === 0) return;
            
            slidesData[currentSlide - 1].fontSize[property] = parseInt(value);
            
            const valueElement = document.getElementById(property + 'Value');
            if (valueElement) {
                valueElement.textContent = value + 'px';
            }
            
            updatePreview();
        }

        // å‰ã®ã‚¹ãƒ©ã‚¤ãƒ‰
        function previousSlide() {
            if (currentSlide > 1) {
                currentSlide--;
                updateUI();
            }
        }

        // æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰
        function nextSlide() {
            if (currentSlide < totalSlides) {
                currentSlide++;
                updateUI();
            }
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰è¿½åŠ 
        function addSlide() {
            if (totalSlides >= 20) {
                alert('æœ€å¤§20æšã¾ã§è¿½åŠ ã§ãã¾ã™');
                return;
            }
            
            const newSlide = {
                title: `æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ ${totalSlides + 1}`,
                body: '',
                backgroundColor: { type: 'solid', color: '#ffffff' },
                layout: { verticalAlign: 'top', textAlign: 'left' },
                fontSize: { titleSize: 68, bodySize: 44 }
            };
            
            slidesData.splice(currentSlide, 0, newSlide);
            totalSlides = slidesData.length;
            currentSlide++;
            
            updateUI();
            alert(`âœ… ã‚¹ãƒ©ã‚¤ãƒ‰ ${currentSlide} ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼`);
        }

        // ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’å‰Šé™¤
        function deleteCurrentSlide() {
            if (totalSlides <= 1) {
                alert('æœ€å¾Œã®ã‚¹ãƒ©ã‚¤ãƒ‰ã¯å‰Šé™¤ã§ãã¾ã›ã‚“');
                return;
            }
            
            if (!confirm(`ã‚¹ãƒ©ã‚¤ãƒ‰ ${currentSlide} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                return;
            }
            
            slidesData.splice(currentSlide - 1, 1);
            totalSlides = slidesData.length;
            
            if (currentSlide > totalSlides) {
                currentSlide = totalSlides;
            }
            
            updateUI();
            alert(`âœ… ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼ï¼ˆæ®‹ã‚Š${totalSlides}æšï¼‰`);
        }

        // ç”»åƒç”Ÿæˆ
        async function generateImages() {
            if (totalSlides === 0) {
                alert('ã¾ãšãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’å…¥åŠ›ã—ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„');
                return;
            }

            document.getElementById('loading').classList.add('active');

            const canvases = [];
            for (let i = 1; i <= totalSlides; i++) {
                const canvas = await generateSlideCanvas(i);
                canvases.push(canvas);
            }

            document.getElementById('loading').classList.remove('active');
            showDownloadModal(canvases);
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’Canvasã§ç”Ÿæˆï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
        async function generateSlideCanvas(slideNum) {
            const canvas = document.createElement('canvas');
            
            // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã«å¿œã˜ã¦è§£åƒåº¦ã‚’è¨­å®š
            switch (aspectRatio) {
                case '9:16':
                    canvas.width = 1080;
                    canvas.height = 1920;
                    break;
                case '1:1':
                    canvas.width = 1080;
                    canvas.height = 1080;
                    break;
                case '16:9':
                    canvas.width = 1920;
                    canvas.height = 1080;
                    break;
                case '4:5':
                default:
                    canvas.width = 1080;
                    canvas.height = 1350;
                    break;
            }
            
            const ctx = canvas.getContext('2d');
            const slide = slidesData[slideNum - 1];
            
            // èƒŒæ™¯æç”»
            const bg = slide.backgroundColor;
            if (bg.type === 'gradient') {
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, bg.colors[0]);
                gradient.addColorStop(1, bg.colors[1]);
                ctx.fillStyle = gradient;
            } else {
                ctx.fillStyle = bg.color;
            }
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ãƒ†ã‚­ã‚¹ãƒˆè‰²ã®æ±ºå®š
            let textColor = '#333';
            if (bg.type === 'gradient' || bg.color === '#1a1a1a' || bg.color === '#2c3e50') {
                textColor = '#fff';
            }
            
            const padding = 120;
            const layout = slide.layout;
            const fontSize = slide.fontSize;
            
            // ã‚¿ã‚¤ãƒˆãƒ«æç”»
            ctx.fillStyle = textColor;
            ctx.font = `bold ${fontSize.titleSize}px "Noto Sans JP", sans-serif`;
            ctx.textAlign = layout.textAlign;
            
            let titleX;
            if (layout.textAlign === 'center') {
                titleX = canvas.width / 2;
            } else if (layout.textAlign === 'right') {
                titleX = canvas.width - padding;
            } else {
                titleX = padding;
            }
            
            let titleY;
            if (layout.verticalAlign === 'center') {
                titleY = canvas.height / 2 - 100;
            } else if (layout.verticalAlign === 'bottom') {
                titleY = canvas.height - 300;
            } else {
                titleY = 200;
            }
            
            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æç”»ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ã‚’å‰Šé™¤ï¼‰
            const cleanTitle = removeMarkdown(slide.title);
            ctx.fillText(cleanTitle, titleX, titleY);
            
            // æœ¬æ–‡æç”»
            if (slide.body) {
                ctx.font = `${fontSize.bodySize}px "Noto Sans JP", sans-serif`;
                ctx.fillStyle = textColor;
                ctx.textAlign = layout.textAlign;
                
                let bodyY = titleY + fontSize.titleSize + 60;
                
                // æœ¬æ–‡ã‚’è¡Œã”ã¨ã«æç”»ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ã‚’å‰Šé™¤ï¼‰
                const cleanBody = removeMarkdown(slide.body);
                const bodyLines = cleanBody.split('\n');
                
                for (let line of bodyLines) {
                    if (line.trim()) {
                        ctx.fillText(line, titleX, bodyY);
                        bodyY += fontSize.bodySize * 1.5;
                    } else {
                        bodyY += fontSize.bodySize * 0.5; // ç©ºè¡Œ
                    }
                    
                    // ç”»é¢å¤–ã«å‡ºãªã„ã‚ˆã†ã«ã™ã‚‹
                    if (bodyY > canvas.height - 100) break;
                }
            }
            
            // ã‚¹ãƒ©ã‚¤ãƒ‰ç•ªå·ï¼ˆæœ€å¾Œä»¥å¤–ï¼‰
            if (slideNum < totalSlides) {
                ctx.font = '24px sans-serif';
                ctx.fillStyle = textColor;
                ctx.globalAlpha = 0.5;
                ctx.textAlign = 'right';
                ctx.fillText('ç¶šã â†’', canvas.width - padding, canvas.height - 60);
                ctx.globalAlpha = 1;
            }
            
            return canvas;
        }

        // ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ã‚’å‰Šé™¤
        function removeMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '$1') // **å¤ªå­—**
                .replace(/\*(.*?)\*/g, '$1')     // *æ–œä½“*
                .replace(/~~(.*?)~~/g, '$1')     // ~~å–ã‚Šæ¶ˆã—ç·š~~
                .replace(/`(.*?)`/g, '$1')       // `ã‚³ãƒ¼ãƒ‰`
                .replace(/__(.*?)__/g, '$1')     // __å¤ªå­—__
                .replace(/_(.*?)_/g, '$1')       // _æ–œä½“_
                .replace(/<[^>]+>/g, '');        // HTMLã‚¿ã‚°
        }

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        function showDownloadModal(canvases) {
            const modal = document.getElementById('downloadModal');
            const grid = document.getElementById('downloadGrid');
            
            grid.innerHTML = '';
            canvases.forEach((canvas, index) => {
                const div = document.createElement('div');
                div.className = 'download-item';
                div.textContent = `${index + 1}`;
                div.onclick = () => downloadImage(canvas, index + 1);
                grid.appendChild(div);
            });
            
            window.generatedCanvases = canvases;
            modal.classList.add('active');
        }

        // å€‹åˆ¥ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadImage(canvas, slideNum) {
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ã‚¹ãƒ©ã‚¤ãƒ‰${String(slideNum).padStart(2, '0')}.png`;
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        // ã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadAll() {
            if (window.generatedCanvases) {
                window.generatedCanvases.forEach((canvas, index) => {
                    setTimeout(() => {
                        downloadImage(canvas, index + 1);
                    }, index * 200);
                });
            }
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('downloadModal').classList.remove('active');
        }
    </script>
</body>
</html>